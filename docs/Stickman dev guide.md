# 스틱맨 포즈 & 모션 개발 가이드

> 이 문서는 스틱맨 포즈/모션을 새로 만들거나 수정할 때 반드시 지켜야 할 규칙들을 정리한 것입니다.
> 기존 개발 과정에서 발견된 문제들과 해결책을 기반으로 작성되었습니다.

---

## 1. 좌표계 & 회전 규칙

### 1.1 SVG 좌표계
- SVG에서 Y축은 **아래쪽이 양수**
- Bone은 기본적으로 **위쪽(Y 음수 방향)**으로 그려짐
- 따라서 팔과 다리가 아래로 향하려면 `180°` 보정이 필요

### 1.2 회전 방향
```
0° = 위쪽 (SVG 기본 방향)
양수(+) = 시계 방향
음수(-) = 반시계 방향
```

### 1.3 ⚠️ 핵심 규칙: 180° 오프셋
Joint.tsx에서 팔과 다리 모두 `rotate(${180 + angle})`을 사용해야 함.
이것이 없으면 각도 0°일 때 팔이 위로 올라감 (토끼귀 버그).

```tsx
// ✅ 올바름
<g transform={`rotate(${180 + upperAngle})`}>

// ❌ 잘못됨 - 팔이 위로 올라감
<g transform={`rotate(${upperAngle})`}>
```

### 1.4 각도값 해석 (180° 보정 적용 후)
```
upperArm 0°   = 팔이 자연스럽게 아래로 늘어뜨림
upperArm -90°  = 팔을 수평으로 올림 (가리키기)
upperArm -150° = 팔을 위로 높이 올림 (만세)
upperArm 30°   = 팔을 뒤로 살짝 뺌

lowerArm 0°   = 팔꿈치 펴짐
lowerArm -90°  = 팔꿈치 90도 구부림
lowerArm -120° = 팔꿈치 강하게 구부림 (턱 만지기)
```

### 1.5 좌우 대칭 규칙
- 왼팔(L)과 오른팔(R)은 **부호가 반대**
- 예: standing 포즈에서 `upperArmL: 20`, `upperArmR: -20`
- 다리도 동일: `upperLegL: 5`, `upperLegR: -5`

---

## 2. 신체 비율 (졸라맨 스타일)

### 2.1 현재 확정된 비율값

| 부위 | 상수명 | 값(px) | 비고 |
|------|--------|--------|------|
| 머리 | `head` (radius) | **30** | 지름 60px |
| 몸통 | `torso` | **70** | - |
| 상완 | `upperArmL/R` | **35** | - |
| 하완 | `lowerArmL/R` | **30** | - |
| 상다리 | `upperLegL/R` | **50** | - |
| 하다리 | `lowerLegL/R` | **45** | - |
| 어깨폭 | `SHOULDER_OFFSET` | **18** | 머리반지름 이하! |
| 골반폭 | `HIP_WIDTH` | **12** | - |

### 2.2 비율 체크 공식
```
전체 높이 = 머리 지름 + 몸통 + 다리전체
          = 60 + 70 + 95 = 225px → 약 3.75등신 ✅

팔/다리 비율 = 65 / 95 = 68% (팔이 다리보다 확실히 짧아야 함)
```

### 2.3 ⚠️ 비율 규칙
- **3~4등신** 유지 (졸라맨 스타일)
- **팔 전체 길이 < 다리 전체 길이의 75%** (안 지키면 거미처럼 보임)
- **SHOULDER_OFFSET < 머리 반지름** (안 지키면 팔이 몸에서 떨어져 보임)
- 비율을 바꿀 때는 반드시 위 공식으로 등신 수와 팔/다리 비율 확인

---

## 3. 팔 부착 위치

### 3.1 어깨 위치 규칙
팔은 torso 꼭대기(목)가 아닌 **약간 아래**에 부착해야 함.

```tsx
// Joint.tsx에서 팔 부착 위치
<g transform={`translate(0, ${-BONE_LENGTHS.torso + 20})`}>
  <Arm side="L" ... />
  <Arm side="R" ... />
</g>
```

### 3.2 ⚠️ 오프셋 계산 규칙
```
팔 부착 오프셋 = torso 길이의 약 25~30%
현재: 20px / 70px = 약 28% ✅
```

- 너무 작으면 (10 이하): 팔이 머리 바로 아래에 붙어 목이 없어 보임
- 너무 크면 (30 이상): 팔이 배에서 나온 것처럼 보임

### 3.3 머리 겹침 방지
- `SHOULDER_OFFSET`을 키워서 해결하지 말 것 (팔이 몸에서 떨어짐)
- 대신 **모션의 팔 올림 각도를 제한** (-130° 이내 권장)

---

## 4. 얼굴 렌더링

### 4.1 졸라맨 스타일 얼굴
- 머리는 **채워진 원** (`fill={color}`)
- 눈/입은 **배경색** (어두운 색)으로 그림
- `fill="none"`으로 하면 투명해서 얼굴이 안 보임

### 4.2 얼굴 상수 (머리 반지름 30 기준)

| 상수 | 값 | 기준 |
|------|-----|------|
| `EYE_Y` | **-10** | 중심에서 위로 (반지름의 33%) |
| `EYE_SPACING` | **14** | 눈 간 거리 (반지름의 47%) |
| `BASE_EYE_SIZE` | **4** | 눈 크기 (반지름의 13%) |
| `MOUTH_Y` | **10** | 중심에서 아래 (반지름의 33%) |
| `MOUTH_WIDTH` | **18** | 입 너비 (반지름의 60%) |

### 4.3 ⚠️ 머리 크기 변경 시
머리 반지름을 바꾸면 **모든 얼굴 상수를 비례 재계산** 필수!
```
새 값 = 현재 값 × (새 반지름 / 30)
```

---

## 5. 선 두께 (lineWidth)

### 5.1 기본값
- `lineWidth` 기본값: **2**
- 관절 원(joint circle)도 이에 비례

### 5.2 ⚠️ 주의사항
- scale이 적용된 후의 두께를 고려할 것
- `scaledLineWidth = lineWidth * scale`
- scale 2.0에서 lineWidth 3이면 실질 6px → 뚱뚱해 보임

---

## 6. 포즈 개발 규칙

### 6.1 포즈 정의 시 필수 체크
1. **10개 관절 모두 정의** (빠지면 0으로 fallback되어 의도하지 않은 결과)
2. **좌우 대칭 확인** (비대칭 포즈도 반대쪽은 기본값 넣기)
3. **standing 포즈와의 전환 자연스러운지** (interpolatePose로 보간됨)

### 6.2 포즈 템플릿
```typescript
newPose: {
  torso: 0,        // -20 ~ 20 (앞뒤 기울임)
  head: 0,         // -45 ~ 45 (좌우/상하)
  upperArmL: 20,   // -180 ~ 180 (기본: 약간 벌림)
  lowerArmL: 0,    // -150 ~ 30 (팔꿈치)
  upperArmR: -20,  // -180 ~ 180 (기본: 약간 벌림)
  lowerArmR: 0,    // -150 ~ 30 (팔꿈치)
  upperLegL: 5,    // -45 ~ 45 (기본: 약간 벌림)
  lowerLegL: 0,    // -60 ~ 10 (무릎)
  upperLegR: -5,   // -45 ~ 45 (기본: 약간 벌림)
  lowerLegR: 0,    // -60 ~ 10 (무릎)
},
```

### 6.3 관절 각도 한계

| 관절 | 최소 | 최대 | 비고 |
|------|------|------|------|
| torso | -20° | 20° | 너무 기울이면 부자연스러움 |
| head | -45° | 45° | - |
| upperArm | -180° | 180° | 올림 시 -130° 이내 권장 |
| lowerArm | -150° | 30° | 팔꿈치는 한쪽으로만 꺾임 |
| upperLeg | -45° | 45° | - |
| lowerLeg | -60° | 10° | 무릎은 뒤로만 꺾임 |

---

## 7. 모션 개발 규칙

### 7.1 모션 vs 포즈 전환 판별

**루프 모션으로 만들 것:**
- 반복이 자연스러운 동작 (걷기, 박수, 타이핑, 호흡 등)
- during 구간에서 계속 재생됨

**포즈 전환으로 만들 것:**
- "한 번 하고 유지"하는 동작 (가리키기, 엄지 척, 손 흔들기 등)
- enter에서 전환 → during에서 유지 + breathing → exit에서 복귀

### 7.2 루프 모션 키프레임 규칙
1. **첫 번째와 마지막 키프레임 동일** (매끄러운 루프)
```typescript
keyframes: [
  { progress: 0, overrides: { torso: 0 } },     // 시작
  { progress: 0.5, overrides: { torso: 3 } },   // 중간
  { progress: 1, overrides: { torso: 0 } },     // 끝 = 시작과 동일!
]
```
2. **cycleDurationMs는 동작 속도에 맞게** (너무 빠르면 경련, 너무 느리면 멈춤)
   - 미세 움직임 (breathing): 1500~2000ms
   - 일반 동작 (nodding, clapping): 400~800ms
   - 빠른 동작 (running, excited): 300~500ms
3. **affectedJoints 정확히 명시** (불필요한 관절 포함하면 다른 모션과 충돌)

### 7.3 모션 override는 덮어쓰기
모션의 override값은 basePose에 **더하는 게 아니라 대체**함.
```typescript
// basePose.upperArmL = 20 (standing)
// motion override: { upperArmL: 30 }
// 결과: upperArmL = 30 (20+30=50이 아님!)
```
따라서 모션에서 지정하는 각도는 **절대값**으로 써야 함.

### 7.4 모션 템플릿
```typescript
newMotion: {
  name: 'motionName',
  cycleDurationMs: 600,                    // 한 주기 시간
  affectedJoints: ['joint1', 'joint2'],    // 영향받는 관절만!
  keyframes: [
    { progress: 0, overrides: { ... } },   // 시작
    { progress: 0.5, overrides: { ... } }, // 중간
    { progress: 1, overrides: { ... } },   // 끝 (= 시작과 동일)
  ],
},
```

---

## 8. 흔한 실수 & 해결

| 증상 | 원인 | 해결 |
|------|------|------|
| 팔이 위로 뻗음 (토끼귀) | Joint.tsx에서 180° 오프셋 누락 | `rotate(${180 + angle})` 확인 |
| 팔이 몸에서 떨어짐 | SHOULDER_OFFSET 과다 | 18 이하로 유지 |
| 팔이 머리에 겹침 | 모션에서 팔 각도 과다 | upperArm -130° 이내 권장 |
| 팔이 목에 붙음 | 팔 부착 오프셋 부족 | torso의 25~30% 오프셋 |
| 얼굴이 안 보임 | 머리 fill="none" | fill={color}로 채우기 |
| 눈코입이 안 보임 | 얼굴 피처가 머리색과 동일 | 배경색으로 그리기 |
| 거미 같아 보임 | 팔이 다리와 비슷한 길이 | 팔 < 다리의 75% |
| 선이 뚱뚱함 | lineWidth 과다 + scale 반영 | 기본 2, scale 고려 |
| 모션이 경련처럼 보임 | cycleDurationMs 너무 짧음 | 300ms 이상 권장 |
| 루프 끊김 | 첫/마지막 키프레임 불일치 | progress 0과 1의 값 동일하게 |
| 걷기가 어색 (정면) | 옆 걷기인데 정면 렌더링 | 루프 제자리 걸음으로 사용 |

---

## 9. 테스트 체크리스트

새 포즈/모션 추가 시 반드시 확인:

- [ ] TypeScript 컴파일 성공
- [ ] Remotion Studio에서 시각적 확인
- [ ] standing 포즈와의 전환(보간) 자연스러운지
- [ ] breathing 모션과 함께 적용 시 정상 작동하는지
- [ ] 좌우 대칭이 맞는지 (비대칭 의도가 아닌 경우)
- [ ] 팔 올림 시 머리와 겹치지 않는지
- [ ] 루프 모션이면: 시작/끝 매끄럽게 연결되는지
- [ ] 포즈 전환이면: enter/during/exit 3단계 모두 정상인지

---

## 10. 파일 구조 참조

```
remotion/src/components/StickMan/
├── skeleton.ts        # 뼈대 상수 (비율, 오프셋) ← 비율 변경 시 여기
├── poses.ts           # 포즈 프리셋 ← 새 포즈 추가 시 여기
├── motions.ts         # 루프 모션 프리셋 ← 새 모션 추가 시 여기
├── expressions.ts     # 표정 정의
├── interpolation.ts   # 보간 + 모션 오버라이드 로직
├── Joint.tsx          # SVG 관절 렌더러 ← 좌표계/회전 규칙은 여기
├── Face.tsx           # SVG 얼굴 렌더러 ← 얼굴 상수는 여기
├── StickMan.tsx       # 메인 컴포넌트 (enter/during/exit 로직)
└── index.ts           # Barrel export
```

---

*최종 업데이트: 2026-02-05*
*스틱맨 모션 템플릿 개발 과정에서 축적된 가이드*